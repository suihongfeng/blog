<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Bert&#39;s Blog</title>
    <meta name="description" content="执着于更高的技术追求！">
    <link rel="icon" href="ltbicon.ico">
  <meta name="theme-color" content="#3eaf7c">
    
    <link rel="preload" href="/blog/assets/css/0.styles.c176169a.css" as="style"><link rel="preload" href="/blog/assets/js/app.c7e0f8d7.js" as="script"><link rel="preload" href="/blog/assets/js/2.1785e0be.js" as="script"><link rel="preload" href="/blog/assets/js/67.3154965a.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.991aa559.js"><link rel="prefetch" href="/blog/assets/js/11.887c9aa2.js"><link rel="prefetch" href="/blog/assets/js/12.24e9ab2e.js"><link rel="prefetch" href="/blog/assets/js/13.c504827e.js"><link rel="prefetch" href="/blog/assets/js/14.afb72089.js"><link rel="prefetch" href="/blog/assets/js/15.e97cfcca.js"><link rel="prefetch" href="/blog/assets/js/16.7ca23074.js"><link rel="prefetch" href="/blog/assets/js/17.1e502820.js"><link rel="prefetch" href="/blog/assets/js/18.3c7c7e27.js"><link rel="prefetch" href="/blog/assets/js/19.b93be35e.js"><link rel="prefetch" href="/blog/assets/js/20.14adbf1d.js"><link rel="prefetch" href="/blog/assets/js/21.8f8c8663.js"><link rel="prefetch" href="/blog/assets/js/22.75e71411.js"><link rel="prefetch" href="/blog/assets/js/23.fd767907.js"><link rel="prefetch" href="/blog/assets/js/24.97415590.js"><link rel="prefetch" href="/blog/assets/js/25.2e930110.js"><link rel="prefetch" href="/blog/assets/js/26.07496033.js"><link rel="prefetch" href="/blog/assets/js/27.0d1a36aa.js"><link rel="prefetch" href="/blog/assets/js/28.b60d2796.js"><link rel="prefetch" href="/blog/assets/js/29.38523c15.js"><link rel="prefetch" href="/blog/assets/js/3.71602b3e.js"><link rel="prefetch" href="/blog/assets/js/30.f15fd2ad.js"><link rel="prefetch" href="/blog/assets/js/31.ecd84713.js"><link rel="prefetch" href="/blog/assets/js/32.3cbe175b.js"><link rel="prefetch" href="/blog/assets/js/33.338e0a4c.js"><link rel="prefetch" href="/blog/assets/js/34.8d335e97.js"><link rel="prefetch" href="/blog/assets/js/35.04d82f1e.js"><link rel="prefetch" href="/blog/assets/js/36.9a2c6d90.js"><link rel="prefetch" href="/blog/assets/js/37.1eca158f.js"><link rel="prefetch" href="/blog/assets/js/38.7108ccb3.js"><link rel="prefetch" href="/blog/assets/js/39.f57e6e81.js"><link rel="prefetch" href="/blog/assets/js/4.3e861142.js"><link rel="prefetch" href="/blog/assets/js/40.49abeb60.js"><link rel="prefetch" href="/blog/assets/js/41.36adf088.js"><link rel="prefetch" href="/blog/assets/js/42.40d03c6b.js"><link rel="prefetch" href="/blog/assets/js/43.553d7ff0.js"><link rel="prefetch" href="/blog/assets/js/44.e66ce9ad.js"><link rel="prefetch" href="/blog/assets/js/45.f9bc055e.js"><link rel="prefetch" href="/blog/assets/js/46.e8133df2.js"><link rel="prefetch" href="/blog/assets/js/47.ecb2340e.js"><link rel="prefetch" href="/blog/assets/js/48.4ac7ac6f.js"><link rel="prefetch" href="/blog/assets/js/49.aff3f131.js"><link rel="prefetch" href="/blog/assets/js/5.3235fd6f.js"><link rel="prefetch" href="/blog/assets/js/50.b0680cf3.js"><link rel="prefetch" href="/blog/assets/js/51.3b6fb633.js"><link rel="prefetch" href="/blog/assets/js/52.9e29e84a.js"><link rel="prefetch" href="/blog/assets/js/53.159c90fa.js"><link rel="prefetch" href="/blog/assets/js/54.571fa2c7.js"><link rel="prefetch" href="/blog/assets/js/55.3bb420b1.js"><link rel="prefetch" href="/blog/assets/js/56.839be921.js"><link rel="prefetch" href="/blog/assets/js/57.ab1cc34c.js"><link rel="prefetch" href="/blog/assets/js/58.af35988d.js"><link rel="prefetch" href="/blog/assets/js/59.b72d3f05.js"><link rel="prefetch" href="/blog/assets/js/6.a7ec59a4.js"><link rel="prefetch" href="/blog/assets/js/60.6f6fc92f.js"><link rel="prefetch" href="/blog/assets/js/61.f2a3360b.js"><link rel="prefetch" href="/blog/assets/js/62.fd60dc03.js"><link rel="prefetch" href="/blog/assets/js/63.80af14b6.js"><link rel="prefetch" href="/blog/assets/js/64.42c46316.js"><link rel="prefetch" href="/blog/assets/js/65.b76b1d7d.js"><link rel="prefetch" href="/blog/assets/js/66.094a4b84.js"><link rel="prefetch" href="/blog/assets/js/68.77771ee1.js"><link rel="prefetch" href="/blog/assets/js/69.244687bd.js"><link rel="prefetch" href="/blog/assets/js/7.3e417887.js"><link rel="prefetch" href="/blog/assets/js/70.01fe8078.js"><link rel="prefetch" href="/blog/assets/js/71.f538c55c.js"><link rel="prefetch" href="/blog/assets/js/72.f59db14b.js"><link rel="prefetch" href="/blog/assets/js/73.66838147.js"><link rel="prefetch" href="/blog/assets/js/74.3dacc29f.js"><link rel="prefetch" href="/blog/assets/js/75.29e39327.js"><link rel="prefetch" href="/blog/assets/js/76.16b4b600.js"><link rel="prefetch" href="/blog/assets/js/77.faa8fe47.js"><link rel="prefetch" href="/blog/assets/js/78.6da3d862.js"><link rel="prefetch" href="/blog/assets/js/79.a9baf8ef.js"><link rel="prefetch" href="/blog/assets/js/8.0e46291f.js"><link rel="prefetch" href="/blog/assets/js/80.ca8838c4.js"><link rel="prefetch" href="/blog/assets/js/81.8ff8c2eb.js"><link rel="prefetch" href="/blog/assets/js/82.ea546051.js"><link rel="prefetch" href="/blog/assets/js/83.96c6b80d.js"><link rel="prefetch" href="/blog/assets/js/84.afb4fec0.js"><link rel="prefetch" href="/blog/assets/js/85.b31d5d2d.js"><link rel="prefetch" href="/blog/assets/js/86.3cfc9954.js"><link rel="prefetch" href="/blog/assets/js/87.ba04822b.js"><link rel="prefetch" href="/blog/assets/js/88.fb8041a8.js"><link rel="prefetch" href="/blog/assets/js/89.8d6a2833.js"><link rel="prefetch" href="/blog/assets/js/9.6ec34283.js"><link rel="prefetch" href="/blog/assets/js/90.54b02613.js"><link rel="prefetch" href="/blog/assets/js/91.857da04f.js"><link rel="prefetch" href="/blog/assets/js/92.045e74ff.js"><link rel="prefetch" href="/blog/assets/js/93.8bd31da4.js"><link rel="prefetch" href="/blog/assets/js/94.8847e0e4.js"><link rel="prefetch" href="/blog/assets/js/95.8cee3c99.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.c176169a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">Bert's Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="教程" class="dropdown-title"><span class="title">教程</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/fun/env.html" class="nav-link">环境配置</a></li><li class="dropdown-item"><!----> <a href="/blog/fun/eslint.html" class="nav-link">eslint规则</a></li><li class="dropdown-item"><!----> <a href="/blog/fun/opt.html" class="nav-link">性能优化</a></li><li class="dropdown-item"><!----> <a href="/blog/fun/wechat.html" class="nav-link">公众号开发总结</a></li><li class="dropdown-item"><!----> <a href="/blog/fun/scaffold.html" class="nav-link">深入浅出前端脚手架</a></li><li class="dropdown-item"><!----> <a href="/blog/fun/javascript-basic.html" class="nav-link">前端基础JS系列</a></li><li class="dropdown-item"><!----> <a href="/blog/fun/optimize.html" class="nav-link">移动端性能优化(一)</a></li><li class="dropdown-item"><!----> <a href="/blog/fun/optimize2.html" class="nav-link">移动端性能优化(二)</a></li><li class="dropdown-item"><!----> <a href="/blog/fun/mobile-bug.html" class="nav-link">移动端的那些坑(一)</a></li><li class="dropdown-item"><!----> <a href="/blog/fun/md.html" class="nav-link">markdown语法</a></li><li class="dropdown-item"><!----> <a href="/blog/static/1_1.html" class="nav-link">全栈入门</a></li><li class="dropdown-item"><!----> <a href="/blog/js/1.html" class="nav-link">JS入门</a></li><li class="dropdown-item"><!----> <a href="/blog/dom/1.html" class="nav-link">DOM教程</a></li><li class="dropdown-item"><!----> <a href="/blog/dd/1-3.html" class="nav-link">JS高级导读</a></li><li class="dropdown-item"><!----> <a href="/blog/fe/vue.html" class="nav-link">前端进阶</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="webpack知识" class="dropdown-title"><span class="title">webpack知识</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/webpack/webpack-base.html" class="nav-link">webpack入门</a></li><li class="dropdown-item"><!----> <a href="/blog/webpack/webpack-note.html" class="nav-link">webpack随手记</a></li><li class="dropdown-item"><!----> <a href="/blog/webpack/webpack-vue.html" class="nav-link">webpack配置vue</a></li><li class="dropdown-item"><!----> <a href="/blog/webpack/webpack.html" class="nav-link">深入webpack</a></li><li class="dropdown-item"><!----> <a href="/blog/webpack/webpack-opt.html" class="nav-link">webpack4 拆包</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="重点技术" class="dropdown-title"><span class="title">重点技术</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/skulpt/1.html" class="nav-link">深入skulpt</a></li><li class="dropdown-item"><!----> <a href="/blog/scratch/links.html" class="nav-link">深入scratch</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="实战分享" class="dropdown-title"><span class="title">实战分享</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/share/env.html" class="nav-link">开发环境配置参考</a></li><li class="dropdown-item"><!----> <a href="/blog/share/ssr.html" class="nav-link router-link-exact-active router-link-active">vue服务端渲染</a></li><li class="dropdown-item"><!----> <a href="/blog/share/mp.html" class="nav-link">小程序开发总结</a></li><li class="dropdown-item"><!----> <a href="/blog/share/iris.html" class="nav-link">go+vue前后端分离实战</a></li><li class="dropdown-item"><!----> <a href="/blog/share/uni.html" class="nav-link">uni-app多端开发回顾</a></li><li class="dropdown-item"><!----> <a href="/blog/share/koa.html" class="nav-link">koa+vue全栈开发实战</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机英语" class="dropdown-title"><span class="title">计算机英语</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/en/webpack.html" class="nav-link">webpack 英文</a></li><li class="dropdown-item"><!----> <a href="/blog/en/npm.html" class="nav-link">npm 英文</a></li><li class="dropdown-item"><!----> <a href="/blog/en/skulpt.html" class="nav-link">skulpt 英文</a></li><li class="dropdown-item"><!----> <a href="/blog/en/scratch.html" class="nav-link">scratch 英文</a></li><li class="dropdown-item"><!----> <a href="/blog/en/ecma.html" class="nav-link">ecma 英文</a></li></ul></div></div><div class="nav-item"><a href="/blog/url/fe.html" class="nav-link">常用网址</a></div><div class="nav-item"><a href="https://github.com/tianbaoliu" target="_blank" rel="noopener noreferrer" class="nav-link external">
  项目地址
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="教程" class="dropdown-title"><span class="title">教程</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/fun/env.html" class="nav-link">环境配置</a></li><li class="dropdown-item"><!----> <a href="/blog/fun/eslint.html" class="nav-link">eslint规则</a></li><li class="dropdown-item"><!----> <a href="/blog/fun/opt.html" class="nav-link">性能优化</a></li><li class="dropdown-item"><!----> <a href="/blog/fun/wechat.html" class="nav-link">公众号开发总结</a></li><li class="dropdown-item"><!----> <a href="/blog/fun/scaffold.html" class="nav-link">深入浅出前端脚手架</a></li><li class="dropdown-item"><!----> <a href="/blog/fun/javascript-basic.html" class="nav-link">前端基础JS系列</a></li><li class="dropdown-item"><!----> <a href="/blog/fun/optimize.html" class="nav-link">移动端性能优化(一)</a></li><li class="dropdown-item"><!----> <a href="/blog/fun/optimize2.html" class="nav-link">移动端性能优化(二)</a></li><li class="dropdown-item"><!----> <a href="/blog/fun/mobile-bug.html" class="nav-link">移动端的那些坑(一)</a></li><li class="dropdown-item"><!----> <a href="/blog/fun/md.html" class="nav-link">markdown语法</a></li><li class="dropdown-item"><!----> <a href="/blog/static/1_1.html" class="nav-link">全栈入门</a></li><li class="dropdown-item"><!----> <a href="/blog/js/1.html" class="nav-link">JS入门</a></li><li class="dropdown-item"><!----> <a href="/blog/dom/1.html" class="nav-link">DOM教程</a></li><li class="dropdown-item"><!----> <a href="/blog/dd/1-3.html" class="nav-link">JS高级导读</a></li><li class="dropdown-item"><!----> <a href="/blog/fe/vue.html" class="nav-link">前端进阶</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="webpack知识" class="dropdown-title"><span class="title">webpack知识</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/webpack/webpack-base.html" class="nav-link">webpack入门</a></li><li class="dropdown-item"><!----> <a href="/blog/webpack/webpack-note.html" class="nav-link">webpack随手记</a></li><li class="dropdown-item"><!----> <a href="/blog/webpack/webpack-vue.html" class="nav-link">webpack配置vue</a></li><li class="dropdown-item"><!----> <a href="/blog/webpack/webpack.html" class="nav-link">深入webpack</a></li><li class="dropdown-item"><!----> <a href="/blog/webpack/webpack-opt.html" class="nav-link">webpack4 拆包</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="重点技术" class="dropdown-title"><span class="title">重点技术</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/skulpt/1.html" class="nav-link">深入skulpt</a></li><li class="dropdown-item"><!----> <a href="/blog/scratch/links.html" class="nav-link">深入scratch</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="实战分享" class="dropdown-title"><span class="title">实战分享</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/share/env.html" class="nav-link">开发环境配置参考</a></li><li class="dropdown-item"><!----> <a href="/blog/share/ssr.html" class="nav-link router-link-exact-active router-link-active">vue服务端渲染</a></li><li class="dropdown-item"><!----> <a href="/blog/share/mp.html" class="nav-link">小程序开发总结</a></li><li class="dropdown-item"><!----> <a href="/blog/share/iris.html" class="nav-link">go+vue前后端分离实战</a></li><li class="dropdown-item"><!----> <a href="/blog/share/uni.html" class="nav-link">uni-app多端开发回顾</a></li><li class="dropdown-item"><!----> <a href="/blog/share/koa.html" class="nav-link">koa+vue全栈开发实战</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机英语" class="dropdown-title"><span class="title">计算机英语</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/en/webpack.html" class="nav-link">webpack 英文</a></li><li class="dropdown-item"><!----> <a href="/blog/en/npm.html" class="nav-link">npm 英文</a></li><li class="dropdown-item"><!----> <a href="/blog/en/skulpt.html" class="nav-link">skulpt 英文</a></li><li class="dropdown-item"><!----> <a href="/blog/en/scratch.html" class="nav-link">scratch 英文</a></li><li class="dropdown-item"><!----> <a href="/blog/en/ecma.html" class="nav-link">ecma 英文</a></li></ul></div></div><div class="nav-item"><a href="/blog/url/fe.html" class="nav-link">常用网址</a></div><div class="nav-item"><a href="https://github.com/tianbaoliu" target="_blank" rel="noopener noreferrer" class="nav-link external">
  项目地址
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span></span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/share/ssr.html#方案调研" class="sidebar-link">方案调研</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/share/ssr.html#什么是服务器端渲染-ssr-？" class="sidebar-link">什么是服务器端渲染 (SSR)？</a></li><li class="sidebar-sub-header"><a href="/blog/share/ssr.html#服务器端渲染的利弊" class="sidebar-link">服务器端渲染的利弊</a></li></ul></li><li><a href="/blog/share/ssr.html#原理分析" class="sidebar-link">原理分析</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/share/ssr.html#如何实现及源码分析" class="sidebar-link">如何实现及源码分析</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/share/ssr.html#生成bundle" class="sidebar-link">生成bundle</a></li><li class="sidebar-sub-header"><a href="/blog/share/ssr.html#createbundlerenderer" class="sidebar-link">createBundleRenderer</a></li><li class="sidebar-sub-header"><a href="/blog/share/ssr.html#rendertostring" class="sidebar-link">renderToString</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>最新我们团队使用vue技术栈对官网进行了重构和优化，经过调研，在架构上前后端分离，由于有SEO的要求，所以需要做服务端渲染，本文将分享一下我们实战的过程。</p> <h2 id="方案调研"><a href="#方案调研" class="header-anchor">#</a> 方案调研</h2> <p>在接到了重构和优化的需求后，我们首先需要去做技术调研，因为vue做服务端渲染已经很成熟了，并且我们团队就基本都用过vue，所以我们优先考虑使用vue技术栈进行重构。</p> <p>实现业务功能和页面并不难，难点在于做服务端渲染，所以我们需要通过官网https://ssr.vuejs.org/zh/的Vue.js 服务器端渲染指南 和 网上各种实战分享了解各种必备知识。</p> <h3 id="什么是服务器端渲染-ssr-？"><a href="#什么是服务器端渲染-ssr-？" class="header-anchor">#</a> 什么是服务器端渲染 (SSR)？</h3> <p>早在SPA (Single Page Application 单页应用) 出现之前，所有的网页就是在服务端渲染的，服务器接收到客户端请求后，将数据和模板拼接成完整的html 文本到客户端。</p> <p>随着 JS 的发展, 特别是支持SPA 的react和vue框架的出现, 呈现页面完全静态化, 动态内容交给前端(Js)渲染, 服务器只提供数据，前端还能控制页面的路由跳转。</p> <p>对于vue的项目，服务端渲染指的是，服务器端将Vue的页面和对应的业务数据，在服务器直接完全渲染成html字符串后，再发送至浏览器, 最后在浏览器中混合为可交互的应用程序。</p> <h3 id="服务器端渲染的利弊"><a href="#服务器端渲染的利弊" class="header-anchor">#</a> 服务器端渲染的利弊</h3> <p>与传统 SPA 相比，采用服务端渲染后，用户能够更快的看到页面内容, 同时也有利于爬虫抓取(SEO)。</p> <p>同时服务端渲染，也需要 node 服务器, 需要耗费性能, 还需要做好缓存和优化, 相当于用空间换时间，全站 ssr 明显不可取, 现在流行较多的是首屏 ssr, 甚至首屏部分 ssr。</p> <h2 id="原理分析"><a href="#原理分析" class="header-anchor">#</a> 原理分析</h2> <p>先看一张Vue官网的服务端渲染示意图：
<img src="/blog/img/ssr.png" alt="原理图.png"></p> <p>从图上可以看出，ssr 有两个入口文件，client.js 和 server.js， 都包含了应用代码，webpack 通过两个入口文件分别打包成给服务端用的 server bundle 和给客户端用的 client bundle。</p> <p>当服务器接收到了来自客户端的请求之后，会创建一个渲染器 bundleRenderer，这个 bundleRenderer 会读取上面生成的 server bundle 文件，并且执行它的代码， 然后发送一个生成好的 html 到浏览器。</p> <p>等到客户端加载了 client bundle 之后，会和服务端生成的DOM 进行 Hydration(判断这个DOM 和自己即将生成的DOM 是否相同，如果相同就将客户端的vue实例挂载到这个DOM上， 否则会提示警告)。</p> <h2 id="如何实现及源码分析"><a href="#如何实现及源码分析" class="header-anchor">#</a> 如何实现及源码分析</h2> <p>不管是参照vue官方的ssr教程从头配置，还是使用第三方的脚手架nuxt.js自动配置，都需要使用nodejs作为服务器渲染打包好的bundle，同时也需要在部署前通过入口文件生成对应的bundle。</p> <h3 id="生成bundle"><a href="#生成bundle" class="header-anchor">#</a> 生成bundle</h3> <ul><li>对于不同端的打包，需要使用对应的webpack插件配置，其中打包client bundle时为：</li></ul> <div class="language- extra-class"><pre class="language-text"><code>const VueSSRClientPlugin = require('vue-server-renderer/client-plugin');
</code></pre></div><p>client-plugin的内容为：</p> <div class="language- extra-class"><pre class="language-text"><code>var onEmit = function (compiler, name, hook) {
  if (compiler.hooks) {
    compiler.hooks.emit.tapAsync(name, hook);
  } else {
    compiler.plugin('emit', hook);     // Webpack &lt; 4.0.0
  }
};
var VueSSRClientPlugin = function VueSSRClientPlugin (options) {
  if ( options === void 0 ) options = {};
  this.options = Object.assign({
    filename: 'vue-ssr-client-manifest.json'
  }, options);
};

VueSSRClientPlugin.prototype.apply = function apply (compiler) {
  var this$1 = this;
  onEmit(compiler, 'vue-client-plugin', function (compilation, cb) {
    var stats = compilation.getStats().toJson();

    var allFiles = uniq(stats.assets
      .map(function (a) { return a.name; }));

    var initialFiles = uniq(Object.keys(stats.entrypoints)
      .map(function (name) { return stats.entrypoints[name].assets; })
      .reduce(function (assets, all) { return all.concat(assets); }, [])
      .filter(function (file) { return isJS(file) || isCSS(file); }));

    var asyncFiles = allFiles
      .filter(function (file) { return isJS(file) || isCSS(file); })
      .filter(function (file) { return initialFiles.indexOf(file) &lt; 0; });

    var manifest = {
      publicPath: stats.publicPath,
      all: allFiles,
      initial: initialFiles,
      async: asyncFiles,
      modules: { /* [identifier: string]: Array&lt;index: number&gt; */ }
    };

    var assetModules = stats.modules.filter(function (m) { return m.assets.length; });
    var fileToIndex = function (file) { return manifest.all.indexOf(file); };
    stats.modules.forEach(function (m) {
      // ignore modules duplicated in multiple chunks
      if (m.chunks.length === 1) {
        var cid = m.chunks[0];
        var chunk = stats.chunks.find(function (c) { return c.id === cid; });
        if (!chunk || !chunk.files) {
          return
        }
        var id = m.identifier.replace(/\s\w+$/, ''); // remove appended hash
        var files = manifest.modules[hash(id)] = chunk.files.map(fileToIndex);
        // find all asset modules associated with the same chunk
        assetModules.forEach(function (m) {
          if (m.chunks.some(function (id) { return id === cid; })) {
            files.push.apply(files, m.assets.map(fileToIndex));
          }
        });
      }
    });

    var json = JSON.stringify(manifest, null, 2);
    compilation.assets[this$1.options.filename] = {
      source: function () { return json; },
      size: function () { return json.length; }
    };
    cb();
  });
};
module.exports = VueSSRClientPlugin;
</code></pre></div><p>而打包server bundle时为：</p> <div class="language- extra-class"><pre class="language-text"><code>const VueSSRServerPlugin = require('vue-server-renderer/server-plugin')
</code></pre></div><p>server-plugin的内容为：</p> <div class="language- extra-class"><pre class="language-text"><code>var onEmit = function (compiler, name, hook) {
  if (compiler.hooks) {
    compiler.hooks.emit.tapAsync(name, hook);
  } else {
    compiler.plugin('emit', hook); // Webpack &lt; 4.0.0
  }
};

var VueSSRServerPlugin = function VueSSRServerPlugin (options) {
  if ( options === void 0 ) options = {};

  this.options = Object.assign({
    filename: 'vue-ssr-server-bundle.json'
  }, options);
};

VueSSRServerPlugin.prototype.apply = function apply (compiler) {
  var this$1 = this;
  validate(compiler); // client插件没有

  onEmit(compiler, 'vue-server-plugin', function (compilation, cb) {
    var stats = compilation.getStats().toJson();
    var entryName = Object.keys(stats.entrypoints)[0];
    var entryInfo = stats.entrypoints[entryName];

    if (!entryInfo) {
      // #5553
      return cb()
    }

    var entryAssets = entryInfo.assets.filter(isJS);

    if (entryAssets.length &gt; 1) {
      throw new Error(
        &quot;Server-side bundle should have one single entry file. &quot; +
        &quot;Avoid using CommonsChunkPlugin in the server config.&quot;
      )
    }

    var entry = entryAssets[0];
    if (!entry || typeof entry !== 'string') {
      throw new Error(
        (&quot;Entry \&quot;&quot; + entryName + &quot;\&quot; not found. Did you specify the correct entry option?&quot;)
      )
    }

    var bundle = {
      entry: entry,
      files: {},
      maps: {}
    };

    stats.assets.forEach(function (asset) {
      if (isJS(asset.name)) {
        bundle.files[asset.name] = compilation.assets[asset.name].source();
      } else if (asset.name.match(/\.js\.map$/)) {
        bundle.maps[asset.name.replace(/\.map$/, '')] = JSON.parse(compilation.assets[asset.name].source());
      }
      // do not emit anything else for server
      delete compilation.assets[asset.name];
    });

    var json = JSON.stringify(bundle, null, 2);
    var filename = this$1.options.filename;

    compilation.assets[filename] = {
      source: function () { return json; },
      size: function () { return json.length; }
    };

    cb();
  });
};

module.exports = VueSSRServerPlugin;
</code></pre></div><p>可以看到 sever-plugin主要多了：</p> <div class="language- extra-class"><pre class="language-text"><code>var validate = function (compiler) {
  if (compiler.options.target !== 'node') {
    warn('webpack config `target` should be &quot;node&quot;.');
  }

  if (compiler.options.output &amp;&amp; compiler.options.output.libraryTarget !== 'commonjs2') {
    warn('webpack config `output.libraryTarget` should be &quot;commonjs2&quot;.');
  }

  if (!compiler.options.externals) {
    tip(
      'It is recommended to externalize dependencies in the server build for ' +
      'better build performance.'
    );
  }
};
</code></pre></div><h3 id="createbundlerenderer"><a href="#createbundlerenderer" class="header-anchor">#</a> createBundleRenderer</h3> <div class="language- extra-class"><pre class="language-text"><code>const { createBundleRenderer } = require('vue-server-renderer');

const createRenderer = (bundle, opts = {}) =&gt; createBundleRenderer(
  bundle,
  Object.assign(opts, {
    basedir: resolve('./dist'),
    template: fs.readFileSync(templatePath, 'utf-8'),
    runInNewContext: false,
  }),
);

(ctx.body = await renderer.renderToString(context));
</code></pre></div><h3 id="rendertostring"><a href="#rendertostring" class="header-anchor">#</a> renderToString</h3> <div class="language- extra-class"><pre class="language-text"><code>    renderToString: function renderToString (
      component,
      context,
      cb
    ) {
      var assign;

      if (typeof context === 'function') {
        cb = context;
        context = {};
      }
      if (context) {
        templateRenderer.bindRenderFns(context);
      }

      // no callback, return Promise
      var promise;
      if (!cb) {
        ((assign = createPromiseCallback(), promise = assign.promise, cb = assign.cb));
      }

      var result = '';
      var write = createWriteFunction(function (text) {
        result += text;
        return false
      }, cb);
      try {
        render(component, write, context, function (err) {
          if (err) {
            return cb(err)
          }
          if (context &amp;&amp; context.rendered) {
            context.rendered(context);
          }
          if (template) {
            try {
              var res = templateRenderer.render(result, context);
              if (typeof res !== 'string') {
                // function template returning promise
                res
                  .then(function (html) { return cb(null, html); })
                  .catch(cb);
              } else {
                cb(null, res);
              }
            } catch (e) {
              cb(e);
            }
          } else {
            cb(null, result);
          }
        });
      } catch (e) {
        cb(e);
      }

      return promise
    },
</code></pre></div><p>可以看到，vue实现服务端渲染主要是依靠vue-server-renderer，打包时用插件生成bundle，然后部署时提供createBundleRenderer处理页面请求，使用renderToString做服务端渲染。</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.c7e0f8d7.js" defer></script><script src="/blog/assets/js/2.1785e0be.js" defer></script><script src="/blog/assets/js/67.3154965a.js" defer></script>
  </body>
</html>
