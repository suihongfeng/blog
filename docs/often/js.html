<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>常用方法封装 | Sarah的博客</title>
    <meta name="description" content="财务大魔王！">
    <link rel="icon" href="shficon.ico">
  <meta name="theme-color" content="#3eaf7c">
    
    <link rel="preload" href="/blog/assets/css/0.styles.f54d1925.css" as="style"><link rel="preload" href="/blog/assets/js/app.76d33b23.js" as="script"><link rel="preload" href="/blog/assets/js/2.cb5424ea.js" as="script"><link rel="preload" href="/blog/assets/js/7.bc98e092.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.49c09dae.js"><link rel="prefetch" href="/blog/assets/js/11.4180ceb5.js"><link rel="prefetch" href="/blog/assets/js/12.e9303c9c.js"><link rel="prefetch" href="/blog/assets/js/13.efdc8714.js"><link rel="prefetch" href="/blog/assets/js/3.799aacf1.js"><link rel="prefetch" href="/blog/assets/js/4.d34ebd53.js"><link rel="prefetch" href="/blog/assets/js/5.68a56bd2.js"><link rel="prefetch" href="/blog/assets/js/6.cb9e4604.js"><link rel="prefetch" href="/blog/assets/js/8.9b7139ed.js"><link rel="prefetch" href="/blog/assets/js/9.ee99811a.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.f54d1925.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">Sarah的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">日常总结</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/often/js.html" class="nav-link router-link-exact-active router-link-active">JS方法封装</a></li><li class="dropdown-item"><!----> <a href="/blog/often/css.html" class="nav-link">CSS样式封装</a></li><li class="dropdown-item"><!----> <a href="/blog/often/scratch1.html" class="nav-link">Scratch篇</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">日常总结</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/often/js.html" class="nav-link router-link-exact-active router-link-active">JS方法封装</a></li><li class="dropdown-item"><!----> <a href="/blog/often/css.html" class="nav-link">CSS样式封装</a></li><li class="dropdown-item"><!----> <a href="/blog/often/scratch1.html" class="nav-link">Scratch篇</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>常用方法封装</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/often/js.html#_1、全屏功能" class="sidebar-link">1、全屏功能</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/often/js.html#_2、检测pc端和移动端设备" class="sidebar-link">2、检测PC端和移动端设备</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/often/js.html#_3、dom片段生成图片" class="sidebar-link">3、dom片段生成图片</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/often/js.html#_4、url生成二维码" class="sidebar-link">4、url生成二维码</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/often/js.html#_5、时间过滤器" class="sidebar-link">5、时间过滤器</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/often/js.html#_6、判断是否是微信浏览器" class="sidebar-link">6、判断是否是微信浏览器</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/often/js.html#_7、判断ios环境" class="sidebar-link">7、判断IOS环境</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/often/js.html#_8、rem布局" class="sidebar-link">8、rem布局</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/often/js.html#_9、绑定虚拟键盘" class="sidebar-link">9、绑定虚拟键盘</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/often/js.html#_10、录屏" class="sidebar-link">10、录屏</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="_1、全屏功能"><a href="#_1、全屏功能" aria-hidden="true" class="header-anchor">#</a> 1、全屏功能</h2> <p>以Vue代码为例。<br></p> <div class="language-js extra-class"><pre class="language-js"><code>dataFull<span class="token punctuation">:</span> 初始值，判断当前页面是否是全屏状态，默认<span class="token boolean">false</span>
show<span class="token punctuation">:</span> 控制全屏图标切换显示

<span class="token comment">// 切换全屏</span>
<span class="token function">fullORno</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>dataFull <span class="token operator">==</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">exitFullscreen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>dataFull <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>show <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">launchFullscreen</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>documentElement<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>dataFull <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>show <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 进入全屏</span>
<span class="token function">launchFullscreen</span><span class="token punctuation">(</span><span class="token parameter">element</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>element<span class="token punctuation">.</span>requestFullscreen<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        element<span class="token punctuation">.</span><span class="token function">requestFullscreen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>element<span class="token punctuation">.</span>mozRequestFullScreen<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        element<span class="token punctuation">.</span><span class="token function">mozRequestFullScreen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>element<span class="token punctuation">.</span>webkitRequestFullscreen<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        element<span class="token punctuation">.</span><span class="token function">webkitRequestFullscreen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>element<span class="token punctuation">.</span>msRequestFullscreen<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        element<span class="token punctuation">.</span><span class="token function">msRequestFullscreen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
 <span class="token comment">// 退出全屏</span>
<span class="token function">exitFullscreen</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>document<span class="token punctuation">.</span>exitFullscreen<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        document<span class="token punctuation">.</span><span class="token function">exitFullscreen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>document<span class="token punctuation">.</span>mozCancelFullScreen<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        document<span class="token punctuation">.</span><span class="token function">mozCancelFullScreen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>document<span class="token punctuation">.</span>webkitExitFullscreen<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        document<span class="token punctuation">.</span><span class="token function">webkitExitFullscreen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_2、检测pc端和移动端设备"><a href="#_2、检测pc端和移动端设备" aria-hidden="true" class="header-anchor">#</a> 2、检测PC端和移动端设备</h2> <p>例子：如果条件成立是移动端，跳转到百度，可根据业务需求进行不同操作。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token regex">/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token regex">/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        window<span class="token punctuation">.</span>location <span class="token operator">=</span> b<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>
  navigator<span class="token punctuation">.</span>userAgent <span class="token operator">||</span> navigator<span class="token punctuation">.</span>vendor <span class="token operator">||</span> window<span class="token punctuation">.</span>opera<span class="token punctuation">,</span>
  <span class="token string">&quot;https://www.baidu.com&quot;</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="_3、dom片段生成图片"><a href="#_3、dom片段生成图片" aria-hidden="true" class="header-anchor">#</a> 3、dom片段生成图片</h2> <blockquote><p>业务场景：海报等活动业务，指定一块区域或者整个页面获取信息后，在移动端可长按保存图片，PC端可以右键保存图片到本地。</p></blockquote> <ul><li>cdn链接：https://cdn.bootcss.com/html2canvas/0.5.0-beta4/html2canvas.min.js</li> <li>html2canvas.js：可将 htmldom 转为 canvas 元素<br></li> <li>canvasAPI：toDataUrl() 可将 canvas 转为 base64 格式<br></li> <li>base64转成file，通过upload接口生成url<br></li></ul> <p>1、设备像素比 (简称 dpr) 定义了物理像素和设备独立像素的对应关系，它的值可以按如下的公式的得到：设备像素比 = 物理像素 / 设备独立像素
所以我们可以先获取设备像素比，然后根据比例创建尺寸更大的canvas，如二倍屏就是二倍，三倍屏就是三倍...<br>
2、图片不能使用background，必须用img标签，具体原因不清楚，亲测。。。（应该是插件本身原因）<br>
3、跨域图片绘制不出来<br>
4、box-shadow在tocanvas时会丢失<br></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/*
* 法一
*/</span>
<span class="token comment">// 要生成图片的dom片段</span>
<span class="token keyword">var</span> div <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByClassName</span><span class="token punctuation">(</span><span class="token string">'page'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;canvas&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> w <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span>div<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">css</span><span class="token punctuation">(</span><span class="token string">'width'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> h <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span>div<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">css</span><span class="token punctuation">(</span><span class="token string">'height'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// 宽高放大两倍</span>
canvas<span class="token punctuation">.</span>width  <span class="token operator">=</span> w <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> h <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
canvas<span class="token punctuation">.</span>style<span class="token punctuation">.</span>width <span class="token operator">=</span> w <span class="token operator">+</span> <span class="token string">&quot;px&quot;</span><span class="token punctuation">;</span>
canvas<span class="token punctuation">.</span>style<span class="token punctuation">.</span>height <span class="token operator">=</span> h <span class="token operator">+</span> <span class="token string">&quot;px&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> context <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&quot;2d&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//然后将画布缩放，将图像放大两倍画到画布上</span>
context<span class="token punctuation">.</span><span class="token function">scale</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">html2canvas</span><span class="token punctuation">(</span>div<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    canvas<span class="token punctuation">:</span> canvas<span class="token punctuation">,</span>
    <span class="token function-variable function">onrendered</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">canvas</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//这里返回了一个canvas 定位一下</span>
        <span class="token function">$</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">css</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token string">'position'</span><span class="token punctuation">:</span><span class="token string">'absolute'</span><span class="token punctuation">,</span>
            <span class="token string">'top'</span><span class="token punctuation">:</span><span class="token string">'0'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>     
        document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>
        _this<span class="token punctuation">.</span>isShowCanvas <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            <span class="token comment">// 将canvas.toDataURL()生成的地址赋给img元素</span>
            <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#canvasImg'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'src'</span><span class="token punctuation">,</span>canvas<span class="token punctuation">.</span><span class="token function">toDataURL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token function">$</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/*-----------------------------------------------------------*/</span>
<span class="token comment">/*
* 法二（随着插件的更新，调用方式随之改变，看版本）
*/</span>
<span class="token comment">// 要生成图片的dom片段</span>
<span class="token keyword">var</span> div <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByClassName</span><span class="token punctuation">(</span><span class="token string">'page'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
div<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.mask'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token string">'100%'</span><span class="token punctuation">;</span>
div<span class="token punctuation">.</span>style<span class="token punctuation">.</span>zIndex <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>div<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;canvas&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// canvas可提前创建，可动态创建</span>
<span class="token keyword">const</span> scaleBy <span class="token operator">=</span> <span class="token constant">DPR</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取像素比</span>

<span class="token comment">// 设定 canvas 元素属性宽高为 DOM 节点宽高 * 像素比</span>
<span class="token keyword">const</span> defaultCanvasOptions <span class="token operator">=</span> <span class="token punctuation">{</span>
  canvas<span class="token punctuation">:</span> canvas <span class="token operator">||</span> <span class="token punctuation">(</span>canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'canvas'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  removeContainer<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  allowTaint<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  imageTimeout<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  async<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token function">ignoreElements</span><span class="token punctuation">(</span><span class="token parameter">element</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> id <span class="token operator">=</span> element<span class="token punctuation">.</span>id
    <span class="token keyword">if</span> <span class="token punctuation">(</span> id<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">'slide'</span><span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span> id<span class="token operator">===</span> <span class="token string">'slide12'</span> <span class="token operator">||</span> id <span class="token operator">===</span> <span class="token string">'loading-page'</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span>
        <span class="token keyword">else</span> <span class="token keyword">return</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> canvas1 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">html2canvas</span><span class="token punctuation">(</span>div<span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token operator">...</span>defaultCanvasOptions<span class="token punctuation">,</span> scale<span class="token punctuation">:</span> scaleBy<span class="token punctuation">}</span><span class="token punctuation">)</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>div<span class="token punctuation">)</span>
<span class="token keyword">let</span> img <span class="token operator">=</span> <span class="token function">getImage</span><span class="token punctuation">(</span><span class="token string">'thumbnail-img'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">img</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#share-page .snapshot'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
img<span class="token punctuation">.</span>src <span class="token operator">=</span> canvas1<span class="token punctuation">.</span><span class="token function">toDataURL</span><span class="token punctuation">(</span><span class="token string">'image/png'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>5、base64转file，使用new FIle会有兼容性支持问题，可以使用toBlob</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">dataURLtoBlob</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> mimeString <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">':'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">';'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
  <span class="token keyword">var</span> byteString <span class="token operator">=</span> <span class="token function">atob</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token keyword">var</span> ab <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayBuffer</span><span class="token punctuation">(</span>byteString<span class="token punctuation">.</span>length<span class="token punctuation">)</span>
  <span class="token keyword">var</span> ia <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span>ab<span class="token punctuation">)</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> byteString<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ia<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> byteString<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">var</span> bb <span class="token operator">=</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>BlobBuilder <span class="token operator">||</span> window<span class="token punctuation">.</span>WebKitBlobBuilder <span class="token operator">||</span> window<span class="token punctuation">.</span>MozBlobBuilder<span class="token punctuation">)</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>bb<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    bb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>BlobBuilder <span class="token operator">||</span> window<span class="token punctuation">.</span>WebKitBlobBuilder <span class="token operator">||</span> window<span class="token punctuation">.</span>MozBlobBuilder<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    bb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>ab<span class="token punctuation">)</span>
    <span class="token keyword">return</span> bb<span class="token punctuation">.</span><span class="token function">getBlob</span><span class="token punctuation">(</span>mimeString<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    bb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span>ab<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token string">'type'</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>mimeString<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> bb
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_4、url生成二维码"><a href="#_4、url生成二维码" aria-hidden="true" class="header-anchor">#</a> 4、url生成二维码</h2> <p>vue为例</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> QRCode <span class="token keyword">from</span> <span class="token string">'qrcode'</span><span class="token punctuation">;</span>
<span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>QRCode <span class="token operator">=</span> QRCode<span class="token punctuation">;</span> <span class="token comment">// 建议挂载到原型上，供他组件调用</span>
<span class="token comment">// 生成二维码</span>
<span class="token function">useqrcode</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'canvas'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>QRCode<span class="token punctuation">.</span><span class="token function">toCanvas</span><span class="token punctuation">(</span>canvas<span class="token punctuation">,</span> url<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'success!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_5、时间过滤器"><a href="#_5、时间过滤器" aria-hidden="true" class="header-anchor">#</a> 5、时间过滤器</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">timeData</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> d <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> year <span class="token operator">=</span> d<span class="token punctuation">.</span><span class="token function">getFullYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> month <span class="token operator">=</span> d<span class="token punctuation">.</span><span class="token function">getMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">9</span> <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">0</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>d<span class="token punctuation">.</span><span class="token function">getMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token punctuation">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>d<span class="token punctuation">.</span><span class="token function">getMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> day <span class="token operator">=</span> d<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">10</span> <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">0</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>d<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token punctuation">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>d<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>year<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>month<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>day<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_6、判断是否是微信浏览器"><a href="#_6、判断是否是微信浏览器" aria-hidden="true" class="header-anchor">#</a> 6、判断是否是微信浏览器</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">isWxUa</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> ua <span class="token operator">=</span> navigator<span class="token punctuation">.</span>userAgent<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ua<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/MicroMessenger/i</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">'micromessenger'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_7、判断ios环境"><a href="#_7、判断ios环境" aria-hidden="true" class="header-anchor">#</a> 7、判断IOS环境</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">isIOS</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> isIphone <span class="token operator">=</span> navigator<span class="token punctuation">.</span>userAgent<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'iPhone'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> isIpad <span class="token operator">=</span> navigator<span class="token punctuation">.</span>userAgent<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'iPad'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> isIphone <span class="token operator">||</span> isIpad<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_8、rem布局"><a href="#_8、rem布局" aria-hidden="true" class="header-anchor">#</a> 8、rem布局</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//封装设置rem的方法</span>
<span class="token keyword">function</span> <span class="token function">setREM</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token comment">//建议 设置UI设计图宽度尺寸 （以1440为例）</span>
	<span class="token keyword">const</span> whdef <span class="token operator">=</span> <span class="token number">100</span><span class="token operator">/</span><span class="token number">1440</span><span class="token punctuation">;</span>
	<span class="token comment">//获取浏览器可见区域宽度</span>
	<span class="token keyword">const</span> wW <span class="token operator">=</span> document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>clientWidth <span class="token operator">||</span> document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>clientWidth<span class="token punctuation">;</span>
	<span class="token comment">//以默认比例值乘以当前窗口宽度,得到该宽度下的相应FONT-SIZE值</span>
	<span class="token keyword">const</span> rem <span class="token operator">=</span> wW <span class="token operator">*</span> whdef<span class="token punctuation">;</span>
	<span class="token comment">//设置字体值  (当屏幕宽度为1440时，font-size = 100px 即1rem = 100px)</span>
	document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>style<span class="token punctuation">.</span>fontSize <span class="token operator">=</span> rem <span class="token operator">+</span> <span class="token string">'px'</span>
<span class="token punctuation">}</span>
<span class="token comment">//先首次调用</span>
window<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token function">setREM</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>	
<span class="token comment">//设置监听浏览器窗口变化函数  动态改变font-size的值</span>
window<span class="token punctuation">.</span><span class="token function-variable function">onresize</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token function">setREM</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_9、绑定虚拟键盘"><a href="#_9、绑定虚拟键盘" aria-hidden="true" class="header-anchor">#</a> 9、绑定虚拟键盘</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/*
 * 给元素添加事件（用来触发键盘事件）
 * el模拟事件的触发元素，evtType事件类型，keycode对应的键盘事件的键值,key对应事件所触发的键名,
 */</span>
<span class="token keyword">function</span> <span class="token function">createKeyEvent</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> evtType<span class="token punctuation">,</span> keyCode <span class="token punctuation">,</span>key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> doc <span class="token operator">=</span> el<span class="token punctuation">.</span>ownerDocument<span class="token punctuation">,</span>
        win <span class="token operator">=</span> doc<span class="token punctuation">.</span>defaultView <span class="token operator">||</span> doc<span class="token punctuation">.</span>parentWindow<span class="token punctuation">,</span>
        evtObj<span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>doc<span class="token punctuation">.</span>createEvent<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>win<span class="token punctuation">.</span>KeyEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            evtObj <span class="token operator">=</span> doc<span class="token punctuation">.</span><span class="token function">createEvent</span><span class="token punctuation">(</span><span class="token string">'KeyEvents'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            evtObj<span class="token punctuation">.</span><span class="token function">initKeyEvent</span><span class="token punctuation">(</span> evtType<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> win<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> keyCode<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            evtObj <span class="token operator">=</span> doc<span class="token punctuation">.</span><span class="token function">createEvent</span><span class="token punctuation">(</span><span class="token string">'UIEvents'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>evtObj<span class="token punctuation">,</span> <span class="token string">'keyCode'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                <span class="token function-variable function">get </span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>keyCodeVal<span class="token punctuation">;</span> <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>evtObj<span class="token punctuation">,</span> <span class="token string">'which'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                <span class="token function-variable function">get </span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>keyCodeVal<span class="token punctuation">;</span> <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            evtObj<span class="token punctuation">.</span><span class="token function">initUIEvent</span><span class="token punctuation">(</span> evtType<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> win<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
            evtObj<span class="token punctuation">.</span>key <span class="token operator">=</span> key<span class="token punctuation">;</span>
            evtObj<span class="token punctuation">.</span>keyCodeVal <span class="token operator">=</span> keyCode<span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token function"> </span><span class="token punctuation">(</span><span class="token parameter">evtObj<span class="token punctuation">.</span>keyCode <span class="token operator">!==</span> keyCode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;keyCode &quot;</span> <span class="token operator">+</span> evtObj<span class="token punctuation">.</span>keyCode <span class="token operator">+</span> <span class="token string">&quot; 和 (&quot;</span> <span class="token operator">+</span> evtObj<span class="token punctuation">.</span>which <span class="token operator">+</span> <span class="token string">&quot;) 不匹配&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        el<span class="token punctuation">.</span><span class="token function">dispatchEvent</span><span class="token punctuation">(</span>evtObj<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token parameter">doc<span class="token punctuation">.</span>createEventObject</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        evtObj <span class="token operator">=</span> doc<span class="token punctuation">.</span><span class="token function">createEventObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        evtObj<span class="token punctuation">.</span>keyCode <span class="token operator">=</span> keyCode<span class="token punctuation">;</span>
        el<span class="token punctuation">.</span><span class="token function">fireEvent</span><span class="token punctuation">(</span><span class="token string">'on'</span> <span class="token operator">+</span> evtType<span class="token punctuation">,</span> evtObj<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">/*
 * 给数组元素批量添加事件（用来触发键盘事件）
 */</span>
<span class="token keyword">function</span> <span class="token function">batchAddEvent</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span>list</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    list <span class="token operator">=</span> list <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>len<span class="token operator">=</span>list<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">&lt;</span>len<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// PC端绑定点击事件触发键盘事件</span>
        <span class="token comment">// list[i].obj.onclick = function () {</span>
        <span class="token comment">//     createKeyEvent(el, 'keydown', list[i].keyCode , list[i].key);</span>
        <span class="token comment">// }</span>
        <span class="token comment">// 移动端需要按下抬起两个动作 touchstart触发keydpown  touchend触发keyup</span>
        list<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>obj<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;touchstart&quot;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            list<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>obj<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;active&quot;</span><span class="token punctuation">)</span>
            <span class="token function">createKeyEvent</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> <span class="token string">'keydown'</span><span class="token punctuation">,</span> list<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>keyCode <span class="token punctuation">,</span> list<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        list<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>obj<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;touchend&quot;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            list<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>obj<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">&quot;active&quot;</span><span class="token punctuation">)</span>
            <span class="token function">createKeyEvent</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> <span class="token string">'keyup'</span><span class="token punctuation">,</span> list<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>keyCode <span class="token punctuation">,</span> list<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">bindkeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> space <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#space'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> up <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#up'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> down <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#down'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> left <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#left'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> right <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#right'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 需要模拟键盘操控的区域</span>
    <span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'ocanvas'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 如果你需要添加事件的元素比较多。可以使用index.js里面的 batchAddEvent方法 批量绑定</span>
    <span class="token keyword">let</span> aele <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            obj<span class="token punctuation">:</span> space<span class="token punctuation">,</span>
            keyCode<span class="token punctuation">:</span> <span class="token number">32</span><span class="token punctuation">,</span>
            key<span class="token punctuation">:</span> <span class="token string">&quot; &quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            obj<span class="token punctuation">:</span> down<span class="token punctuation">,</span>
            keyCode<span class="token punctuation">:</span> <span class="token number">40</span><span class="token punctuation">,</span>
            key<span class="token punctuation">:</span> <span class="token string">&quot;ArrowDown&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            obj<span class="token punctuation">:</span> left<span class="token punctuation">,</span>
            keyCode<span class="token punctuation">:</span> <span class="token number">37</span><span class="token punctuation">,</span>
            key<span class="token punctuation">:</span> <span class="token string">&quot;ArrowLeft&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            obj<span class="token punctuation">:</span> right<span class="token punctuation">,</span>
            keyCode<span class="token punctuation">:</span> <span class="token number">39</span><span class="token punctuation">,</span>
            key<span class="token punctuation">:</span> <span class="token string">&quot;ArrowRight&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            obj<span class="token punctuation">:</span> up<span class="token punctuation">,</span>
            keyCode<span class="token punctuation">:</span> <span class="token number">38</span><span class="token punctuation">,</span>
            key<span class="token punctuation">:</span> <span class="token string">&quot;ArrowUp&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token function">batchAddEvent</span><span class="token punctuation">(</span>canvas<span class="token punctuation">,</span>aele<span class="token punctuation">)</span>

    <span class="token comment">// 监听事件（移动端举例）</span>
    canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'touchmove'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'touchstart'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'touchend'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'keydown'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'keyup'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_10、录屏"><a href="#_10、录屏" aria-hidden="true" class="header-anchor">#</a> 10、录屏</h2> <p>参考链接：</p> <ul><li>https://www.javascriptcn.com/read-34705.html</li> <li>https://www.webrtc-experiment.com/RecordRTC/Canvas-Recording/</li></ul> <h4 id="原生js实现录屏，复制后可直接在浏览器运行"><a href="#原生js实现录屏，复制后可直接在浏览器运行" aria-hidden="true" class="header-anchor">#</a> <font color="#016ab8">原生JS实现录屏，复制后可直接在浏览器运行</font></h4> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype">&lt;!DOCTYPE html&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
		    <span class="token selector">#btn</span> <span class="token punctuation">{</span>
		    	<span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
		    	<span class="token property">width</span><span class="token punctuation">:</span> 150px<span class="token punctuation">;</span>
		    	<span class="token property">left</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>
		    	<span class="token property">top</span><span class="token punctuation">:</span> 500px<span class="token punctuation">;</span>
		    	<span class="token property">margin</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span>
		    <span class="token punctuation">}</span>
		    <span class="token selector">#div</span> <span class="token punctuation">{</span>
		    	<span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
		    	<span class="token property">top</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
		    	<span class="token property">border</span><span class="token punctuation">:</span> 5px solid gray<span class="token punctuation">;</span>
		    	<span class="token property">border-radius</span><span class="token punctuation">:</span> 5px<span class="token punctuation">;</span> 
		    	<span class="token property">padding</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span> 
		    	<span class="token property">margin</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span>
		    	<span class="token property">width</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span> 
		    	<span class="token property">height</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span>
		    <span class="token punctuation">}</span>
		    <span class="token selector">#div #share</span> <span class="token punctuation">{</span>
		    	<span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
		    	<span class="token property">top</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
		    	<span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
		    	<span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
		    	<span class="token property">height</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
		    	<span class="token property">background</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>
		    	<span class="token property">display</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
		    <span class="token punctuation">}</span>
		    <span class="token selector">#parentVideo</span> <span class="token punctuation">{</span>
    	    	<span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
			    <span class="token property">top</span><span class="token punctuation">:</span> 0%<span class="token punctuation">;</span>
			    <span class="token property">right</span><span class="token punctuation">:</span> 6%<span class="token punctuation">;</span>
		        <span class="token property">width</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span> 
		    	<span class="token property">height</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span>
		    <span class="token punctuation">}</span>
		    <span class="token selector">#parentVideo&gt;video</span><span class="token punctuation">{</span>
	        	<span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
	        <span class="token punctuation">}</span>
	        <span class="token selector">#audio</span> <span class="token punctuation">{</span>
	        	<span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
	        	<span class="token property">top</span><span class="token punctuation">:</span> 400px<span class="token punctuation">;</span>
	        <span class="token punctuation">}</span>
		</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>btn<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>btn-start<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>开始录制<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>btn-stop<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>结束录制<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>parentVideo<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>播放区域<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
		    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>video</span> <span class="token attr-name">controls</span> <span class="token attr-name">autoplay</span> <span class="token attr-name">playsinline</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>video<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>video</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>div<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>屏幕录制区域<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
		    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>请开始你的表演<span class="token punctuation">&quot;</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">=&quot;</span><span class="token attr-value"><span class="token property">width</span><span class="token punctuation">:</span> 80%<span class="token punctuation">;</span><span class="token property">font-size</span><span class="token punctuation">:</span> 16px<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
		    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>share<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
		    	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>等待录音中。。。。。请稍等。。。。。。。红色背景消失开始录制<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
		    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>canvas<span class="token punctuation">&quot;</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">=&quot;</span><span class="token attr-value"><span class="token property">position</span><span class="token punctuation">:</span>absolute<span class="token punctuation">;</span> <span class="token property">top</span><span class="token punctuation">:</span>-99999999px<span class="token punctuation">;</span> <span class="token property">left</span><span class="token punctuation">:</span>-9999999999px<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
		
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>https://www.webrtc-experiment.com/RecordRTC.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>https://webrtc.github.io/adapter/adapter-latest.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>https://www.webrtc-experiment.com/html2canvas.min.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
		
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
			<span class="token keyword">var</span> elementToRecord <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">var</span> canvas2d <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'canvas'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			canvas2d<span class="token punctuation">.</span>width <span class="token operator">=</span> elementToRecord<span class="token punctuation">.</span>clientWidth<span class="token punctuation">;</span>
			canvas2d<span class="token punctuation">.</span>height <span class="token operator">=</span> elementToRecord<span class="token punctuation">.</span>clientHeight<span class="token punctuation">;</span>
			<span class="token keyword">var</span> context <span class="token operator">=</span> canvas2d<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">'2d'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">var</span> canvasStream <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">captureStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">var</span> finalStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MediaStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">var</span> audioStream <span class="token operator">=</span> <span class="token keyword">null</span>
			<span class="token keyword">var</span> isStoppedRecording <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
			<span class="token keyword">var</span> recorderVideo <span class="token operator">=</span> <span class="token keyword">null</span>
			<span class="token keyword">var</span> isRecorder <span class="token operator">=</span> <span class="token boolean">false</span> <span class="token comment">// 控制是否需要录音</span>
			
			document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'btn-start'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'video'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
				document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'btn-stop'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>disabled <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
				isStoppedRecording <span class="token operator">=</span> <span class="token boolean">false</span>
				isRecorder <span class="token operator">=</span> <span class="token function">confirm</span><span class="token punctuation">(</span><span class="token string">'视频需要录音吗'</span><span class="token punctuation">)</span>
			    isRecorder <span class="token operator">?</span> <span class="token punctuation">(</span><span class="token function">startAudio</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'share'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'block'</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token function">startVideo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span><span class="token punctuation">;</span>
			
			document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'btn-stop'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			    isStoppedRecording <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
			    <span class="token function">stopAudioOrVideo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
            
            <span class="token comment">// 生成canvas视频</span>
			<span class="token keyword">function</span> <span class="token function">looper</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">if</span><span class="token punctuation">(</span>isStoppedRecording<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		            <span class="token keyword">return</span><span class="token punctuation">;</span>
		        <span class="token punctuation">}</span>
			    <span class="token function">html2canvas</span><span class="token punctuation">(</span>elementToRecord<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">canvas</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			        context<span class="token punctuation">.</span><span class="token function">clearRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> canvas2d<span class="token punctuation">.</span>width<span class="token punctuation">,</span> canvas2d<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
			        context<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>canvas<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> canvas2d<span class="token punctuation">.</span>width<span class="token punctuation">,</span> canvas2d<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
			    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			    <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>looper<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			
			<span class="token comment">// 开始录屏方法</span>
			<span class="token keyword">function</span> <span class="token function">startVideo</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				recorderVideo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RecordRTC</span><span class="token punctuation">(</span>canvas2d<span class="token punctuation">,</span> <span class="token punctuation">{</span>	<span class="token comment">// 录制canvas生成视频</span>
				    type<span class="token punctuation">:</span> <span class="token string">'canvas'</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				recorderVideo<span class="token punctuation">.</span><span class="token function">startRecording</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			    <span class="token function">setTimeout</span><span class="token punctuation">(</span>looper<span class="token punctuation">,</span><span class="token number">500</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
			
			<span class="token comment">// 开始录音方法</span>
			<span class="token keyword">function</span> <span class="token function">startAudio</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				navigator<span class="token punctuation">.</span>mediaDevices<span class="token punctuation">.</span><span class="token function">getUserMedia</span><span class="token punctuation">(</span><span class="token punctuation">{</span> audio<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>successAudioCallback<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token comment">// 录音设备准备成功后回调</span>
			<span class="token keyword">function</span> <span class="token function">successAudioCallback</span><span class="token punctuation">(</span><span class="token parameter">audioStream</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token function">getTracks</span><span class="token punctuation">(</span>audioStream<span class="token punctuation">,</span> <span class="token string">'audio'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">track</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					finalStream<span class="token punctuation">.</span><span class="token function">addTrack</span><span class="token punctuation">(</span>track<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token function">getTracks</span><span class="token punctuation">(</span>canvasStream<span class="token punctuation">,</span> <span class="token string">'video'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">track</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					finalStream<span class="token punctuation">.</span><span class="token function">addTrack</span><span class="token punctuation">(</span>track<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				
				recorderVideo <span class="token operator">=</span> <span class="token function">RecordRTC</span><span class="token punctuation">(</span>finalStream<span class="token punctuation">,</span> <span class="token punctuation">{</span>
					type<span class="token punctuation">:</span> <span class="token string">'video'</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				recorderVideo<span class="token punctuation">.</span><span class="token function">startRecording</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			    <span class="token function">setTimeout</span><span class="token punctuation">(</span>looper<span class="token punctuation">,</span><span class="token number">500</span><span class="token punctuation">)</span>
			    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'可以开始录音了'</span><span class="token punctuation">)</span>
			    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'share'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'none'</span>
			<span class="token punctuation">}</span>
			<span class="token comment">// 结束录音录屏方法</span>
			<span class="token keyword">function</span> <span class="token function">stopAudioOrVideo</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				recorderVideo<span class="token punctuation">.</span><span class="token function">stopRecording</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">audioURL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	                document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'video'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>src <span class="token operator">=</span> audioURL<span class="token punctuation">;</span>
	                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>audioURL<span class="token punctuation">)</span>
	                recorderVideo<span class="token punctuation">.</span><span class="token function">getDataURL</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">dataURL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	                	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>dataURL<span class="token punctuation">)</span>
	                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	                <span class="token keyword">var</span> recordedBlob <span class="token operator">=</span> recorderVideo<span class="token punctuation">.</span><span class="token function">getBlob</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>recordedBlob<span class="token punctuation">)</span>
	                <span class="token keyword">var</span> fd <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					fd<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;audioData&quot;</span><span class="token punctuation">,</span> recordedBlob<span class="token punctuation">)</span><span class="token punctuation">;</span>
					console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>fd<span class="token punctuation">)</span>
	                <span class="token comment">// document.getElementById('video').src = URL.createObjectURL(recordedBlob)</span>
	                <span class="token comment">// canvasStream.stop();</span>
					<span class="token comment">// audioStream.stop();</span>
					recorderVideo<span class="token punctuation">.</span><span class="token function">clearRecordedData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			
			<span class="token comment">// 上传到后台，根据业务自行修改</span>
			<span class="token keyword">function</span> <span class="token function">upLoad</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">var</span> fd <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				fd<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;audioData&quot;</span><span class="token punctuation">,</span> blob<span class="token punctuation">)</span><span class="token punctuation">;</span>
				$<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
				    url<span class="token punctuation">:</span> <span class="token string">'/upload'</span><span class="token punctuation">,</span>
				    type<span class="token punctuation">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>
				    cache<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
				    data<span class="token punctuation">:</span> fd<span class="token punctuation">,</span>
				    processData<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
				    contentType<span class="token punctuation">:</span> <span class="token boolean">false</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
			
		</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.76d33b23.js" defer></script><script src="/blog/assets/js/2.cb5424ea.js" defer></script><script src="/blog/assets/js/7.bc98e092.js" defer></script>
  </body>
</html>
